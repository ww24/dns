box: debian:8

build:
  steps:
    - install-packages:
      packages: wget unzip

    - inokappa/terraform-install:
      version: 0.7.13

    - script:
      name: set working directory
      code: |
        export WERCKER_SOURCE_DIR=$WERCKER_SOURCE_DIR/terraform
        echo "WERCKER_SOURCE_DIR=$WERCKER_SOURCE_DIR"

    - script:
      name: generate account.json
      code: |
        ./account.json.template.sh > account.json

    - script:
      name: terraform plan
      code: |
        terraform plan -var-file=variables.tfvars

deploy:
  steps:
    - script:
      name: terraform apply
      code: |
        terraform apply -var-file=variables.tfvars
